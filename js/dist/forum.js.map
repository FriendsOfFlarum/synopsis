{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@ianm/synopsis/./src/common/extend.ts","webpack://@ianm/synopsis/./src/forum/addSummaryExcerpt.tsx","webpack://@ianm/synopsis/./src/forum/addUserPreference.ts","webpack://@ianm/synopsis/./src/forum/components/Excerpt.tsx","webpack://@ianm/synopsis/./src/forum/components/index.ts","webpack://@ianm/synopsis/./src/forum/extend.ts","webpack://@ianm/synopsis/./src/forum/index.ts","webpack://@ianm/synopsis/external root \"flarum.core.compat['common/Component']\"","webpack://@ianm/synopsis/external root \"flarum.core.compat['common/components/FieldSet']\"","webpack://@ianm/synopsis/external root \"flarum.core.compat['common/components/Switch']\"","webpack://@ianm/synopsis/external root \"flarum.core.compat['common/extend']\"","webpack://@ianm/synopsis/external root \"flarum.core.compat['common/extenders']\"","webpack://@ianm/synopsis/external root \"flarum.core.compat['common/utils/ItemList']\"","webpack://@ianm/synopsis/external root \"flarum.core.compat['common/utils/Stream']\"","webpack://@ianm/synopsis/external root \"flarum.core.compat['common/utils/string']\"","webpack://@ianm/synopsis/external root \"flarum.core.compat['forum/app']\"","webpack://@ianm/synopsis/external root \"flarum.core.compat['forum/components/DiscussionListItem']\"","webpack://@ianm/synopsis/external root \"flarum.core.compat['forum/components/SettingsPage']\"","webpack://@ianm/synopsis/external root \"flarum.core.compat['forum/states/DiscussionListState']\"","webpack://@ianm/synopsis/external root \"flarum.core.compat['tags/common/models/Tag']\"","webpack://@ianm/synopsis/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@ianm/synopsis/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@ianm/synopsis/webpack/bootstrap","webpack://@ianm/synopsis/webpack/runtime/compat get default export","webpack://@ianm/synopsis/webpack/runtime/define property getters","webpack://@ianm/synopsis/webpack/runtime/hasOwnProperty shorthand","webpack://@ianm/synopsis/webpack/runtime/make namespace object","webpack://@ianm/synopsis/./forum.ts"],"sourcesContent":["import Extend from 'flarum/common/extenders';\nimport Tag from 'flarum/tags/common/models/Tag';\n\nexport default [\n  new Extend.Model(Tag) //\n    .attribute<boolean>('richExcerpts')\n    .attribute<number>('excerptLength'),\n];\n","import { extend } from 'flarum/common/extend';\nimport app from 'flarum/forum/app';\nimport DiscussionListState from 'flarum/forum/states/DiscussionListState';\nimport DiscussionListItem from 'flarum/forum/components/DiscussionListItem';\nimport ItemList from 'flarum/common/utils/ItemList';\nimport type Mithril from 'mithril';\nimport Excerpt from './components/Excerpt';\n\nexport default function addSummaryExcerpt() {\n  extend(DiscussionListState.prototype, 'requestParams', function (params) {\n    if (typeof params.include === 'string') {\n      params.include = [params.include];\n    } else {\n      params.include = params.include || [];\n    }\n\n    if (app.forum.attribute<string>('synopsis.excerpt_type') === 'first') {\n      params.include.push('firstPost');\n    } else {\n      params.include.push('lastPost');\n    }\n  });\n\n  extend(DiscussionListItem.prototype, 'infoItems', function (items: ItemList<Mithril.Children>) {\n    // Skip if we are searching to preserve most relevant post content as excerpt,\n    // that way we also preserve highlighting of search terms in the most relevant post.\n    // @ts-expect-error\n    if (app.forum.attribute('synopsis.disable_when_searching') && app.discussions.params.q) return;\n\n    const discussion = this.attrs.discussion;\n\n    if (app.session.user && !app.session.user.preferences()?.showSynopsisExcerpts) {\n      return;\n    }\n\n    const tags = discussion.tags();\n    let tag;\n    if (tags) {\n      tag = tags[tags.length - 1];\n    }\n\n    const excerptPost = app.forum.attribute<string>('synopsis.excerpt_type') === 'first' ? discussion.firstPost() : discussion.lastPost();\n    const excerptLength = typeof tag?.excerptLength() === 'number' ? tag?.excerptLength() : app.forum.attribute<number>('synopsis.excerpt_length');\n    const richExcerpt = typeof tag?.richExcerpts() === 'number' ? tag?.richExcerpts() : app.forum.attribute<boolean>('synopsis.rich_excerpts');\n    const onMobile = app.session.user ? app.session.user.preferences()?.showSynopsisExcerptsOnMobile : false;\n\n    // A length of zero means we don't want a synopsis for this discussion, so do nothing.\n    if (excerptLength === 0) {\n      return;\n    }\n\n    if (excerptPost) {\n      const excerpt = <Excerpt post={excerptPost} length={excerptLength} richExcerpt={richExcerpt} />;\n\n      items.add('excerpt', excerpt, -100);\n      onMobile && items.add('excerptM', excerpt, -100);\n    }\n  });\n}\n","import app from 'flarum/forum/app';\nimport { extend } from 'flarum/common/extend';\nimport SettingsPage from 'flarum/forum/components/SettingsPage';\nimport FieldSet from 'flarum/common/components/FieldSet';\nimport ItemList from 'flarum/common/utils/ItemList';\nimport Switch from 'flarum/common/components/Switch';\nimport Stream from 'flarum/common/utils/Stream';\nimport type Mithril from 'mithril';\n\nexport default function () {\n  extend(SettingsPage.prototype, 'oninit', function () {\n    this.showSynopsisExcerpts = Stream(this.user?.preferences()?.showSynopsisExcerpts);\n    this.showSynopsisExcerptsOnMobile = Stream(this.user?.preferences()?.showSynopsisExcerptsOnMobile);\n  });\n\n  extend(SettingsPage.prototype, 'settingsItems', function (items) {\n    items.add(\n      'synopsis',\n      FieldSet.component(\n        {\n          label: app.translator.trans('fof-synopsis.forum.user.settings.summaries-heading'),\n          className: 'Settings-Synopsis',\n        },\n        this.summariesItems().toArray()\n      )\n    );\n  });\n\n  SettingsPage.prototype['summariesItems'] = function () {\n    const items = new ItemList<Mithril.Children>();\n    if (!this.user) return items;\n\n    const prefs = this.user.preferences();\n\n    items.add(\n      'synopsis-excerpts',\n      Switch.component(\n        {\n          state: prefs?.showSynopsisExcerpts,\n          onchange: (value: boolean) => {\n            this.showSynopsisExcerptsLoading = true;\n\n            this.user?.savePreferences({ showSynopsisExcerpts: value }).then(() => {\n              this.showSynopsisExcerptsLoading = false;\n              m.redraw();\n            });\n          },\n          loading: this.showSynopsisExcerptsLoading,\n        },\n        app.translator.trans('fof-synopsis.forum.user.settings.show-summaries')\n      )\n    );\n\n    if (prefs?.showSynopsisExcerpts) {\n      items.add(\n        'synopsis-excerpts-mobile',\n        Switch.component(\n          {\n            state: prefs?.showSynopsisExcerptsOnMobile,\n            disabled: !prefs?.showSynopsisExcerpts,\n            onchange: (value: boolean) => {\n              this.showSynopsisExcerptsOnMobileLoading = true;\n\n              this.user?.savePreferences({ showSynopsisExcerptsOnMobile: value }).then(() => {\n                this.showSynopsisExcerptsOnMobileLoading = false;\n                window.location.reload();\n              });\n            },\n            loading: this.showSynopsisExcerptsOnMobileLoading,\n          },\n          app.translator.trans('fof-synopsis.forum.user.settings.show-summaries-mobile')\n        )\n      );\n    }\n\n    return items;\n  };\n}\n","import Component, { ComponentAttrs } from 'flarum/common/Component';\nimport Post from 'flarum/common/models/Post';\nimport { truncate } from 'flarum/common/utils/string';\nimport type Mithril from 'mithril';\n\nexport interface ExcerptAttrs extends ComponentAttrs {\n  post: Post;\n  length: number;\n  richExcerpt: boolean;\n}\n\nexport default class Excerpt extends Component<ExcerptAttrs> {\n  post!: Post;\n  length!: number;\n  richExcerpt!: boolean;\n\n  oninit(vnode: Mithril.Vnode<ExcerptAttrs, this>) {\n    super.oninit(vnode);\n\n    this.post = this.attrs.post;\n    this.length = this.attrs.length;\n    this.richExcerpt = this.attrs.richExcerpt;\n  }\n\n  view() {\n    return <div className=\"Synopsis-excerpt\">{m.trust(this.getContent())}</div>;\n  }\n\n  getContent(): string {\n    return this.richExcerpt ? truncate(this.contentRich() ?? '', this.length) : truncate(this.contentPlain() ?? '', this.length);\n  }\n\n  contentRich() {\n    return this.post.contentHtml();\n  }\n\n  contentPlain() {\n    return this.post.contentPlain();\n  }\n}\n","import Excerpt from './Excerpt';\n\nexport const components = {\n  Excerpt,\n};\n","import Extend from 'flarum/common/extenders';\nimport commonExtend from '../common/extend';\n\nexport default [...commonExtend];\n","import app from 'flarum/forum/app';\nimport addSummaryExcerpt from './addSummaryExcerpt';\nimport addUserPreference from './addUserPreference';\n\nexport { default as extend } from './extend';\n\nexport * from './components';\n\napp.initializers.add('fof-synopsis', () => {\n  addSummaryExcerpt();\n  addUserPreference();\n});\n","module.exports = flarum.core.compat['common/Component'];","module.exports = flarum.core.compat['common/components/FieldSet'];","module.exports = flarum.core.compat['common/components/Switch'];","module.exports = flarum.core.compat['common/extend'];","module.exports = flarum.core.compat['common/extenders'];","module.exports = flarum.core.compat['common/utils/ItemList'];","module.exports = flarum.core.compat['common/utils/Stream'];","module.exports = flarum.core.compat['common/utils/string'];","module.exports = flarum.core.compat['forum/app'];","module.exports = flarum.core.compat['forum/components/DiscussionListItem'];","module.exports = flarum.core.compat['forum/components/SettingsPage'];","module.exports = flarum.core.compat['forum/states/DiscussionListState'];","module.exports = flarum.core.compat['tags/common/models/Tag'];","import setPrototypeOf from \"./setPrototypeOf.js\";\nfunction _inheritsLoose(t, o) {\n  t.prototype = Object.create(o.prototype), t.prototype.constructor = t, setPrototypeOf(t, o);\n}\nexport { _inheritsLoose as default };","function _setPrototypeOf(t, e) {\n  return _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) {\n    return t.__proto__ = e, t;\n  }, _setPrototypeOf(t, e);\n}\nexport { _setPrototypeOf as default };","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","/* This is part of the ianm/synopsis project.\n\n * Additional modifications (c)2020 Ian Morland\n *\n * Modified code (c)2019 Jordan Schnaidt\n *\n * Original code (c) Toby Zerner <toby.zerner@gmail.com>\n *\n * For the full copyright and license information, please view the LICENSE\n * file that was distributed with this source code.\n */\n\nexport * from './src/forum';\n"],"names":["Extend","Tag","Model","attribute","extend","app","DiscussionListState","DiscussionListItem","Excerpt","addSummaryExcerpt","prototype","params","include","forum","push","items","_app$session$user$pre","_tag","_tag2","_tag3","_tag4","_app$session$user$pre2","discussions","q","discussion","attrs","session","user","preferences","showSynopsisExcerpts","tags","tag","length","excerptPost","firstPost","lastPost","excerptLength","richExcerpt","richExcerpts","onMobile","showSynopsisExcerptsOnMobile","excerpt","m","post","add","SettingsPage","FieldSet","ItemList","Switch","Stream","_this$user","_this$user2","component","label","translator","trans","className","summariesItems","toArray","_this","prefs","state","onchange","value","_this$user3","showSynopsisExcerptsLoading","savePreferences","then","redraw","loading","disabled","_this$user4","showSynopsisExcerptsOnMobileLoading","window","location","reload","Component","truncate","_Component","_len","arguments","args","Array","_key","call","apply","concat","_inheritsLoose","_proto","oninit","vnode","view","trust","getContent","_this$contentRich","_this$contentPlain","contentRich","contentPlain","contentHtml","default","components","commonExtend","addUserPreference","initializers","setPrototypeOf","t","o","Object","create","constructor","_setPrototypeOf","e","bind","__proto__"],"sourceRoot":""}