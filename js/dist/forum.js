(()=>{var t={n:s=>{var e=s&&s.__esModule?()=>s.default:()=>s;return t.d(e,{a:e}),e},d:(s,e)=>{for(var o in e)t.o(e,o)&&!t.o(s,o)&&Object.defineProperty(s,o,{enumerable:!0,get:e[o]})},o:(t,s)=>Object.prototype.hasOwnProperty.call(t,s),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},s={};(()=>{"use strict";t.r(s),t.d(s,{components:()=>j});const e=flarum.core.compat["forum/app"];var o=t.n(e);const n=flarum.core.compat["common/extend"],r=flarum.core.compat["forum/states/DiscussionListState"];var i=t.n(r);const c=flarum.core.compat["forum/components/DiscussionListItem"];var p=t.n(c);const a=flarum.core.compat["tags/models/Tag"];var u=t.n(a);const l=flarum.core.compat["common/Model"];var h=t.n(l);function f(t,s){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,s){return t.__proto__=s,t},f(t,s)}const y=flarum.core.compat["common/Component"];var d=t.n(y);const x=flarum.core.compat["common/utils/string"];var g=function(t){function s(){for(var s,e=arguments.length,o=new Array(e),n=0;n<e;n++)o[n]=arguments[n];return(s=t.call.apply(t,[this].concat(o))||this).post=void 0,s.length=void 0,s.richExcerpt=void 0,s}var e,o;o=t,(e=s).prototype=Object.create(o.prototype),e.prototype.constructor=e,f(e,o);var n=s.prototype;return n.oninit=function(s){t.prototype.oninit.call(this,s),this.post=this.attrs.post,this.length=this.attrs.length,this.richExcerpt=this.attrs.richExcerpt},n.view=function(){return m("div",{className:"Synopsis-excerpt"},m.trust(this.getContent()))},n.getContent=function(){var t,s;return this.richExcerpt?(0,x.truncate)(null!=(t=this.contentRich())?t:"",this.length):(0,x.truncate)(null!=(s=this.contentPlain())?s:"",this.length)},n.contentRich=function(){return this.post.contentHtml()},n.contentPlain=function(){return this.post.contentPlain()},s}(d());const v=flarum.core.compat["forum/components/SettingsPage"];var b=t.n(v);const S=flarum.core.compat["common/components/FieldSet"];var w=t.n(S);const E=flarum.core.compat["common/utils/ItemList"];var O=t.n(E);const P=flarum.core.compat["common/components/Switch"];var _=t.n(P);const L=flarum.core.compat["common/utils/Stream"];var M=t.n(L),j={Excerpt:g};o().initializers.add("ianm-synopsis",(function(){o().initializers.has("flarum-tags")&&(u().prototype.richExcerpts=h().attribute("richExcerpts"),u().prototype.excerptLength=h().attribute("excerptLength")),(0,n.extend)(i().prototype,"requestParams",(function(t){"first"===o().forum.attribute("synopsis.excerpt_type")?t.include.push("firstPost"):t.include.push("lastPost")})),(0,n.extend)(p().prototype,"infoItems",(function(t){var s,e,n,r,i,c;if(!o().forum.attribute("synopsis.disable_when_searching")||!o().discussions.params.q){var p=this.attrs.discussion;if(!o().session.user||null!=(s=o().session.user.preferences())&&s.showSynopsisExcerpts){var a,u=p.tags();u&&(a=u[u.length-1]);var l="first"===o().forum.attribute("synopsis.excerpt_type")?p.firstPost():p.lastPost(),h="number"==typeof(null==(e=a)?void 0:e.excerptLength())?null==(n=a)?void 0:n.excerptLength():o().forum.attribute("synopsis.excerpt_length"),f="number"==typeof(null==(r=a)?void 0:r.richExcerpts())?null==(i=a)?void 0:i.richExcerpts():o().forum.attribute("synopsis.rich_excerpts"),y=!!o().session.user&&(null==(c=o().session.user.preferences())?void 0:c.showSynopsisExcerptsOnMobile);if(0!==h&&l){var d=m(g,{post:l,length:h,richExcerpt:f});t.add(y?"excerptM":"excerpt",d,-100)}}}})),(0,n.extend)(b().prototype,"oninit",(function(){this.showSynopsisExcerpts=M()(this.user.preferences().showSynopsisExcerpts),this.showSynopsisExcerptsOnMobile=M()(this.user.preferences().showSynopsisExcerptsOnMobile)})),(0,n.extend)(b().prototype,"settingsItems",(function(t){t.add("synopsis",w().component({label:o().translator.trans("ianm-synopsis.forum.user.settings.summaries-heading"),className:"Settings-Synopsis"},this.summariesItems().toArray()))})),b().prototype.summariesItems=function(){var t=this,s=new(O());return s.add("synopsis-excerpts",_().component({state:this.user.preferences().showSynopsisExcerpts,onchange:function(s){t.showSynopsisExcerptsLoading=!0,t.user.savePreferences({showSynopsisExcerpts:s}).then((function(){t.showSynopsisExcerptsLoading=!1,m.redraw()}))},loading:this.showSynopsisExcerptsLoading},o().translator.trans("ianm-synopsis.forum.user.settings.show-summaries"))),this.user.preferences().showSynopsisExcerpts&&s.add("synopsis-excerpts-mobile",_().component({state:this.user.preferences().showSynopsisExcerptsOnMobile,disabled:!this.user.preferences().showSynopsisExcerpts,onchange:function(s){t.showSynopsisExcerptsOnMobileLoading=!0,t.user.savePreferences({showSynopsisExcerptsOnMobile:s}).then((function(){t.showSynopsisExcerptsOnMobileLoading=!1,window.location.reload()}))},loading:this.showSynopsisExcerptsOnMobileLoading},o().translator.trans("ianm-synopsis.forum.user.settings.show-summaries-mobile"))),s}}))})(),module.exports=s})();
//# sourceMappingURL=forum.js.map