(()=>{var s={n:e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},d:(e,t)=>{for(var o in t)s.o(t,o)&&!s.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},o:(s,e)=>Object.prototype.hasOwnProperty.call(s,e)};(()=>{"use strict";const e=flarum.core.compat["forum/app"];var t=s.n(e);const o=flarum.core.compat["common/extend"],n=flarum.core.compat["forum/states/DiscussionListState"];var r=s.n(n);const i=flarum.core.compat["forum/components/DiscussionListItem"];var c=s.n(i);const a=flarum.core.compat["common/utils/string"],p=flarum.core.compat["tags/models/Tag"];var u=s.n(p);const l=flarum.core.compat["common/Model"];var f=s.n(l);const h=flarum.core.compat["forum/components/SettingsPage"];var d=s.n(h);const y=flarum.core.compat["common/components/FieldSet"];var x=s.n(y);const g=flarum.core.compat["common/utils/ItemList"];var v=s.n(g);const w=flarum.core.compat["common/components/Switch"];var b=s.n(w);const S=flarum.core.compat["common/utils/Stream"];var E=s.n(S);t().initializers.add("ianm-synopsis",(function(){t().initializers.has("flarum-tags")&&(u().prototype.richExcerpts=f().attribute("richExcerpts"),u().prototype.excerptLength=f().attribute("excerptLength")),(0,o.extend)(r().prototype,"requestParams",(function(s){"first"===t().forum.attribute("synopsis.excerpt_type")?s.include.push("firstPost"):s.include.push("lastPost")})),(0,o.extend)(c().prototype,"infoItems",(function(s){var e,o,n,r,i,c;if(!t().forum.attribute("synopsis.disable_when_searching")||!t().discussions.params.q){var p=this.attrs.discussion;if(!t().session.user||null!=(e=t().session.user.preferences())&&e.showSynopsisExcerpts){var u,l=p.tags();l&&(u=l[l.length-1]);var f="first"===t().forum.attribute("synopsis.excerpt_type")?p.firstPost():p.lastPost(),h="number"==typeof(null==(o=u)?void 0:o.excerptLength())?null==(n=u)?void 0:n.excerptLength():t().forum.attribute("synopsis.excerpt_length"),d="number"==typeof(null==(r=u)?void 0:r.richExcerpts())?null==(i=u)?void 0:i.richExcerpts():t().forum.attribute("synopsis.rich_excerpts"),y=!!t().session.user&&(null==(c=t().session.user.preferences())?void 0:c.showSynopsisExcerptsOnMobile);if(0!==h&&null!=f&&null!=f.contentHtml&&f.contentHtml()){var x=d?m.trust((0,a.truncate)(f.contentHtml(),h)):(0,a.truncate)(f.contentPlain(),h);if(f){var g=m("div",null,x);s.add(y?"excerptM":"excerpt",g,-100)}}}}})),(0,o.extend)(d().prototype,"oninit",(function(){this.showSynopsisExcerpts=E()(this.user.preferences().showSynopsisExcerpts),this.showSynopsisExcerptsOnMobile=E()(this.user.preferences().showSynopsisExcerptsOnMobile)})),(0,o.extend)(d().prototype,"settingsItems",(function(s){s.add("synopsis",x().component({label:t().translator.trans("ianm-synopsis.forum.user.settings.summaries-heading"),className:"Settings-Synopsis"},this.summariesItems().toArray()))})),d().prototype.summariesItems=function(){var s=this,e=new(v());return e.add("synopsis-excerpts",b().component({state:this.user.preferences().showSynopsisExcerpts,onchange:function(e){s.showSynopsisExcerptsLoading=!0,s.user.savePreferences({showSynopsisExcerpts:e}).then((function(){s.showSynopsisExcerptsLoading=!1,m.redraw()}))},loading:this.showSynopsisExcerptsLoading},t().translator.trans("ianm-synopsis.forum.user.settings.show-summaries"))),this.user.preferences().showSynopsisExcerpts&&e.add("synopsis-excerpts-mobile",b().component({state:this.user.preferences().showSynopsisExcerptsOnMobile,disabled:!this.user.preferences().showSynopsisExcerpts,onchange:function(e){s.showSynopsisExcerptsOnMobileLoading=!0,s.user.savePreferences({showSynopsisExcerptsOnMobile:e}).then((function(){s.showSynopsisExcerptsOnMobileLoading=!1,window.location.reload()}))},loading:this.showSynopsisExcerptsOnMobileLoading},t().translator.trans("ianm-synopsis.forum.user.settings.show-summaries-mobile"))),e}}))})(),module.exports={}})();
//# sourceMappingURL=forum.js.map