module.exports=function(e){var t={};function s(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,s),n.l=!0,n.exports}return s.m=e,s.c=t,s.d=function(e,t,o){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(s.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(o,n,function(t){return e[t]}.bind(null,n));return o},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=14)}([,function(e,t){e.exports=flarum.core.compat["forum/app"]},function(e,t){e.exports=flarum.core.compat["common/extend"]},function(e,t){e.exports=flarum.core.compat["tags/models/Tag"]},function(e,t){e.exports=flarum.core.compat["common/Model"]},function(e,t){e.exports=flarum.core.compat["common/utils/Stream"]},function(e,t){e.exports=flarum.core.compat["forum/components/SettingsPage"]},,function(e,t){e.exports=flarum.core.compat["common/utils/string"]},function(e,t){e.exports=flarum.core.compat["common/components/Switch"]},function(e,t){e.exports=flarum.core.compat["forum/states/DiscussionListState"]},function(e,t){e.exports=flarum.core.compat["forum/components/DiscussionListItem"]},function(e,t){e.exports=flarum.core.compat["common/components/FieldSet"]},function(e,t){e.exports=flarum.core.compat["common/utils/ItemList"]},function(e,t,s){"use strict";s.r(t);var o=s(1),n=s.n(o),r=s(2),i=s(10),c=s.n(i),a=s(11),p=s.n(a),u=s(8),f=s(3),l=s.n(f),x=s(4),d=s.n(x);function h(e){var t=e.replace(/(<\/p>|<br>)/g,"$1 &nbsp;").replace(/<img\b[^>]*>/gi," "),s=(new DOMParser).parseFromString(t,"text/html").documentElement;return h.removeSelectors.forEach((function(e){s.querySelectorAll(e).forEach((function(e){e.remove()}))})),s.innerText.replace(/\s+/g," ").trim()}h.removeSelectors=["blockquote","script"];var y=s(6),b=s.n(y),g=s(12),S=s.n(g),v=s(13),w=s.n(v),E=s(9),O=s.n(E),M=s(5),P=s.n(M);n.a.initializers.add("ianm-synopsis",(function(){n.a.initializers.has("flarum-tags")&&(l.a.prototype.richExcerpts=d.a.attribute("richExcerpts"),l.a.prototype.excerptLength=d.a.attribute("excerptLength")),Object(r.extend)(c.a.prototype,"requestParams",(function(e){"first"===n.a.forum.attribute("synopsis.excerpt_type")?e.include.push("firstPost"):e.include.push("lastPost")})),Object(r.extend)(p.a.prototype,"infoItems",(function(e){var t,s,o,r,i=this.attrs.discussion;if(!n.a.session.user||n.a.session.user.preferences().showSynopsisExcerpts){var c,a=i.tags();a&&(c=a[a.length-1]);var p="first"===n.a.forum.attribute("synopsis.excerpt_type")?i.firstPost():i.lastPost(),f="number"==typeof(null==(t=c)?void 0:t.excerptLength())?null==(s=c)?void 0:s.excerptLength():n.a.forum.attribute("synopsis.excerpt_length"),l="number"==typeof(null==(o=c)?void 0:o.richExcerpts())?null==(r=c)?void 0:r.richExcerpts():n.a.forum.attribute("synopsis.rich_excerpts"),x=!!n.a.session.user&&n.a.session.user.preferences().showSynopsisExcerptsOnMobile;if(0!==f){var d=l?m.trust(Object(u.truncate)(p.contentHtml(),f)):Object(u.truncate)(h(p.contentHtml()),f);if(p){var y=m("div",{inert:!0},d);e.add(x?"excerptM":"excerpt",y,-100)}}}})),Object(r.extend)(b.a.prototype,"oninit",(function(){this.showSynopsisExcerpts=P()(this.user.preferences().showSynopsisExcerpts),this.showSynopsisExcerptsOnMobile=P()(this.user.preferences().showSynopsisExcerptsOnMobile)})),Object(r.extend)(b.a.prototype,"settingsItems",(function(e){e.add("synopsis",S.a.component({label:n.a.translator.trans("ianm-synopsis.forum.user.settings.summaries-heading"),className:"Settings-Synopsis"},this.summariesItems().toArray()))})),b.a.prototype.summariesItems=function(){var e=this,t=new w.a;return t.add("synopsis-excerpts",O.a.component({state:this.user.preferences().showSynopsisExcerpts,onchange:function(t){e.showSynopsisExcerptsLoading=!0,e.user.savePreferences({showSynopsisExcerpts:t}).then((function(){e.showSynopsisExcerptsLoading=!1,m.redraw()}))},loading:this.showSynopsisExcerptsLoading},n.a.translator.trans("ianm-synopsis.forum.user.settings.show-summaries"))),this.user.preferences().showSynopsisExcerpts&&t.add("synopsis-excerpts-mobile",O.a.component({state:this.user.preferences().showSynopsisExcerptsOnMobile,disabled:!this.user.preferences().showSynopsisExcerpts,onchange:function(t){e.showSynopsisExcerptsOnMobileLoading=!0,e.user.savePreferences({showSynopsisExcerptsOnMobile:t}).then((function(){e.showSynopsisExcerptsOnMobileLoading=!1,window.location.reload()}))},loading:this.showSynopsisExcerptsOnMobileLoading},n.a.translator.trans("ianm-synopsis.forum.user.settings.show-summaries-mobile"))),t}}))}]);
//# sourceMappingURL=forum.js.map