(()=>{var t={n:s=>{var e=s&&s.__esModule?()=>s.default:()=>s;return t.d(e,{a:e}),e},d:(s,e)=>{for(var o in e)t.o(e,o)&&!t.o(s,o)&&Object.defineProperty(s,o,{enumerable:!0,get:e[o]})},o:(t,s)=>Object.prototype.hasOwnProperty.call(t,s),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},s={};(()=>{"use strict";t.r(s),t.d(s,{components:()=>C,extend:()=>I});const e=flarum.core.compat["forum/app"];var o=t.n(e);const n=flarum.core.compat["common/extend"],r=flarum.core.compat["forum/states/DiscussionListState"];var i=t.n(r);const c=flarum.core.compat["forum/components/DiscussionListItem"];var a=t.n(c);function p(t,s){return p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,s){return t.__proto__=s,t},p(t,s)}const u=flarum.core.compat["common/Component"];var l=t.n(u);const h=flarum.core.compat["common/utils/string"];var f=function(t){function s(){for(var s,e=arguments.length,o=new Array(e),n=0;n<e;n++)o[n]=arguments[n];return(s=t.call.apply(t,[this].concat(o))||this).post=void 0,s.length=void 0,s.richExcerpt=void 0,s}var e,o;o=t,(e=s).prototype=Object.create(o.prototype),e.prototype.constructor=e,p(e,o);var n=s.prototype;return n.oninit=function(s){t.prototype.oninit.call(this,s),this.post=this.attrs.post,this.length=this.attrs.length,this.richExcerpt=this.attrs.richExcerpt},n.view=function(){return m("div",{className:"Synopsis-excerpt"},m.trust(this.getContent()))},n.getContent=function(){var t,s;return this.richExcerpt?(0,h.truncate)(null!=(t=this.contentRich())?t:"",this.length):(0,h.truncate)(null!=(s=this.contentPlain())?s:"",this.length)},n.contentRich=function(){return this.post.contentHtml()},n.contentPlain=function(){return this.post.contentPlain()},s}(l());const d=flarum.core.compat["forum/components/SettingsPage"];var y=t.n(d);const v=flarum.core.compat["common/components/FieldSet"];var x=t.n(v);const g=flarum.core.compat["common/utils/ItemList"];var b=t.n(g);const S=flarum.core.compat["common/components/Switch"];var w=t.n(S);const E=flarum.core.compat["common/utils/Stream"];var O=t.n(E);const P=flarum.core.compat["common/extenders"];var _=t.n(P);const M=flarum.core.compat["tags/common/models/Tag"];var L=t.n(M);const j=[new(_().Model)(L()).attribute("richExcerpts").attribute("excerptLength")],I=[].concat(j);var C={Excerpt:f};o().initializers.add("fof-synopsis",(function(){(0,n.extend)(i().prototype,"requestParams",(function(t){"string"==typeof t.include?t.include=[t.include]:t.include=t.include||[],"first"===o().forum.attribute("synopsis.excerpt_type")?t.include.push("firstPost"):t.include.push("lastPost")})),(0,n.extend)(a().prototype,"infoItems",(function(t){var s,e,n,r,i,c;if(!o().forum.attribute("synopsis.disable_when_searching")||!o().discussions.params.q){var a=this.attrs.discussion;if(!o().session.user||null!=(s=o().session.user.preferences())&&s.showSynopsisExcerpts){var p,u=a.tags();u&&(p=u[u.length-1]);var l="first"===o().forum.attribute("synopsis.excerpt_type")?a.firstPost():a.lastPost(),h="number"==typeof(null==(e=p)?void 0:e.excerptLength())?null==(n=p)?void 0:n.excerptLength():o().forum.attribute("synopsis.excerpt_length"),d="number"==typeof(null==(r=p)?void 0:r.richExcerpts())?null==(i=p)?void 0:i.richExcerpts():o().forum.attribute("synopsis.rich_excerpts"),y=!!o().session.user&&(null==(c=o().session.user.preferences())?void 0:c.showSynopsisExcerptsOnMobile);if(0!==h&&l){var v=m(f,{post:l,length:h,richExcerpt:d});t.add("excerpt",v,-100),y&&t.add("excerptM",v,-100)}}}})),(0,n.extend)(y().prototype,"oninit",(function(){var t,s;this.showSynopsisExcerpts=O()(null==(t=this.user)||null==(t=t.preferences())?void 0:t.showSynopsisExcerpts),this.showSynopsisExcerptsOnMobile=O()(null==(s=this.user)||null==(s=s.preferences())?void 0:s.showSynopsisExcerptsOnMobile)})),(0,n.extend)(y().prototype,"settingsItems",(function(t){t.add("synopsis",x().component({label:o().translator.trans("fof-synopsis.forum.user.settings.summaries-heading"),className:"Settings-Synopsis"},this.summariesItems().toArray()))})),y().prototype.summariesItems=function(){var t=this,s=new(b());if(!this.user)return s;var e=this.user.preferences();return s.add("synopsis-excerpts",w().component({state:null==e?void 0:e.showSynopsisExcerpts,onchange:function(s){var e;t.showSynopsisExcerptsLoading=!0,null==(e=t.user)||e.savePreferences({showSynopsisExcerpts:s}).then((function(){t.showSynopsisExcerptsLoading=!1,m.redraw()}))},loading:this.showSynopsisExcerptsLoading},o().translator.trans("fof-synopsis.forum.user.settings.show-summaries"))),null!=e&&e.showSynopsisExcerpts&&s.add("synopsis-excerpts-mobile",w().component({state:null==e?void 0:e.showSynopsisExcerptsOnMobile,disabled:!(null!=e&&e.showSynopsisExcerpts),onchange:function(s){var e;t.showSynopsisExcerptsOnMobileLoading=!0,null==(e=t.user)||e.savePreferences({showSynopsisExcerptsOnMobile:s}).then((function(){t.showSynopsisExcerptsOnMobileLoading=!1,window.location.reload()}))},loading:this.showSynopsisExcerptsOnMobileLoading},o().translator.trans("fof-synopsis.forum.user.settings.show-summaries-mobile"))),s}}))})(),module.exports=s})();
//# sourceMappingURL=forum.js.map