(()=>{var t={n:e=>{var s=e&&e.__esModule?()=>e.default:()=>e;return t.d(s,{a:s}),s},d:(e,s)=>{for(var o in s)t.o(s,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:s[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};(()=>{"use strict";t.r(e),t.d(e,{components:()=>j});const s=flarum.core.compat["forum/app"];var o=t.n(s);const n=flarum.core.compat["common/extend"],r=flarum.core.compat["forum/states/DiscussionListState"];var i=t.n(r);const c=flarum.core.compat["forum/components/DiscussionListItem"];var p=t.n(c);const a=flarum.core.compat["tags/models/Tag"];var u=t.n(a);const l=flarum.core.compat["common/Model"];var h=t.n(l);function f(t,e){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},f(t,e)}const y=flarum.core.compat["common/Component"];var d=t.n(y);const x=flarum.core.compat["common/utils/string"];var g=function(t){function e(){for(var e,s=arguments.length,o=new Array(s),n=0;n<s;n++)o[n]=arguments[n];return(e=t.call.apply(t,[this].concat(o))||this).post=void 0,e.length=void 0,e.richExcerpt=void 0,e}var s,o;o=t,(s=e).prototype=Object.create(o.prototype),s.prototype.constructor=s,f(s,o);var n=e.prototype;return n.oninit=function(e){t.prototype.oninit.call(this,e),this.post=this.attrs.post,this.length=this.attrs.length,this.richExcerpt=this.attrs.richExcerpt},n.view=function(){return m("div",null,m.trust(this.getContent()))},n.getContent=function(){var t,e;return this.richExcerpt?(0,x.truncate)(null!=(t=this.contentRich())?t:"",this.length):(0,x.truncate)(null!=(e=this.contentPlain())?e:"",this.length)},n.contentRich=function(){return this.post.contentHtml()},n.contentPlain=function(){return this.post.contentPlain()},e}(d());const v=flarum.core.compat["forum/components/SettingsPage"];var b=t.n(v);const S=flarum.core.compat["common/components/FieldSet"];var w=t.n(S);const E=flarum.core.compat["common/utils/ItemList"];var O=t.n(E);const P=flarum.core.compat["common/components/Switch"];var _=t.n(P);const L=flarum.core.compat["common/utils/Stream"];var M=t.n(L),j={Excerpt:g};o().initializers.add("ianm-synopsis",(function(){o().initializers.has("flarum-tags")&&(u().prototype.richExcerpts=h().attribute("richExcerpts"),u().prototype.excerptLength=h().attribute("excerptLength")),(0,n.extend)(i().prototype,"requestParams",(function(t){"first"===o().forum.attribute("synopsis.excerpt_type")?t.include.push("firstPost"):t.include.push("lastPost")})),(0,n.extend)(p().prototype,"infoItems",(function(t){var e,s,n,r,i,c;if(!o().forum.attribute("synopsis.disable_when_searching")||!o().discussions.params.q){var p=this.attrs.discussion;if(!o().session.user||null!=(e=o().session.user.preferences())&&e.showSynopsisExcerpts){var a,u=p.tags();u&&(a=u[u.length-1]);var l="first"===o().forum.attribute("synopsis.excerpt_type")?p.firstPost():p.lastPost(),h="number"==typeof(null==(s=a)?void 0:s.excerptLength())?null==(n=a)?void 0:n.excerptLength():o().forum.attribute("synopsis.excerpt_length"),f="number"==typeof(null==(r=a)?void 0:r.richExcerpts())?null==(i=a)?void 0:i.richExcerpts():o().forum.attribute("synopsis.rich_excerpts"),y=!!o().session.user&&(null==(c=o().session.user.preferences())?void 0:c.showSynopsisExcerptsOnMobile);if(0!==h&&l){var d=m(g,{post:l,length:h,richExcerpt:f});t.add(y?"excerptM":"excerpt",d,-100)}}}})),(0,n.extend)(b().prototype,"oninit",(function(){this.showSynopsisExcerpts=M()(this.user.preferences().showSynopsisExcerpts),this.showSynopsisExcerptsOnMobile=M()(this.user.preferences().showSynopsisExcerptsOnMobile)})),(0,n.extend)(b().prototype,"settingsItems",(function(t){t.add("synopsis",w().component({label:o().translator.trans("ianm-synopsis.forum.user.settings.summaries-heading"),className:"Settings-Synopsis"},this.summariesItems().toArray()))})),b().prototype.summariesItems=function(){var t=this,e=new(O());return e.add("synopsis-excerpts",_().component({state:this.user.preferences().showSynopsisExcerpts,onchange:function(e){t.showSynopsisExcerptsLoading=!0,t.user.savePreferences({showSynopsisExcerpts:e}).then((function(){t.showSynopsisExcerptsLoading=!1,m.redraw()}))},loading:this.showSynopsisExcerptsLoading},o().translator.trans("ianm-synopsis.forum.user.settings.show-summaries"))),this.user.preferences().showSynopsisExcerpts&&e.add("synopsis-excerpts-mobile",_().component({state:this.user.preferences().showSynopsisExcerptsOnMobile,disabled:!this.user.preferences().showSynopsisExcerpts,onchange:function(e){t.showSynopsisExcerptsOnMobileLoading=!0,t.user.savePreferences({showSynopsisExcerptsOnMobile:e}).then((function(){t.showSynopsisExcerptsOnMobileLoading=!1,window.location.reload()}))},loading:this.showSynopsisExcerptsOnMobileLoading},o().translator.trans("ianm-synopsis.forum.user.settings.show-summaries-mobile"))),e}}))})(),module.exports=e})();
//# sourceMappingURL=forum.js.map